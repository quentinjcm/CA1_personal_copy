<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.9.1"/>
<title>myRT: src/RenderTask.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">myRT
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.9.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">RenderTask.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="_render_task_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="preprocessor">#include &lt;memory&gt;</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="preprocessor">#include &lt;algorithm&gt;</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="preprocessor">#include &lt;cmath&gt;</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="preprocessor">#include &lt;ctime&gt;</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="preprocessor">#include&lt;chrono&gt;</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="preprocessor">#include &lt;ngl/NGLStream.h&gt;</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="preprocessor">#include &lt;ngl/Colour.h&gt;</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="_render_task_8hpp.html">RenderTask.hpp</a>&quot;</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="_film_8hpp.html">Film.hpp</a>&quot;</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="_camera_8hpp.html">Camera.hpp</a>&quot;</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="_primative_8hpp.html">Primative.hpp</a>&quot;</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="_material_8hpp.html">Material.hpp</a>&quot;</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;</div>
<div class="line"><a name="l00018"></a><span class="lineno"><a class="line" href="class_render_task.html#ad22541ecdb33be6cb10553fb35006e74">   18</a></span>&#160;<a class="code" href="class_render_task.html#ad22541ecdb33be6cb10553fb35006e74">RenderTask::RenderTask</a>(<a class="code" href="class_camera.html">Camera</a> *_cam,</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;                       <a class="code" href="class_film.html">Film</a> *_film,</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;                       std::shared_ptr&lt;Scene&gt; _scene,</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;                       <span class="keywordtype">int</span> _xMin, <span class="keywordtype">int</span> _yMin,</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;                       <span class="keywordtype">int</span> _xMax, <span class="keywordtype">int</span> _yMax,</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;                       std::shared_ptr&lt;RenderSettings&gt; _settings):</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;  m_cam(_cam),</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;  m_film(_film),</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;  m_scene(_scene),</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;  m_settings(_settings),</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;  m_xMin(_xMin),</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;  m_yMin(_yMin),</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;  m_xMax(_xMax),</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;  m_yMax(_yMax)</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;{</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;  <span class="comment">//setting up the random number generator for random sampling</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;  <a class="code" href="class_render_task.html#a29fb8fe5f3a20d5c2ed8bcaadb2f8962">m_generator</a> = std::mt19937(std::random_device{}());</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;  <a class="code" href="class_render_task.html#a2ec2ffc7d648a128606d10c171f313b8">m_distribution</a> =  std::uniform_real_distribution&lt;double&gt;(-0.5, 0.5);</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;}</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;</div>
<div class="line"><a name="l00038"></a><span class="lineno"><a class="line" href="class_render_task.html#a723a8517f2d24fdab3e40f47f4404e3e">   38</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_render_task.html#a723a8517f2d24fdab3e40f47f4404e3e">RenderTask::render</a>()</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;{</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;  <span class="comment">//runs through each pixel in the task</span></div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> x = <a class="code" href="class_render_task.html#a6ec50c2582398ec0cefac94862ed3a5e">m_xMin</a>; x &lt; <a class="code" href="class_render_task.html#af908b199e0e2b5137c3b70806ae6f58c">m_xMax</a>; x++)</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;  {</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> y = <a class="code" href="class_render_task.html#ae4327b10c3c1d16325c0b9d2e124e1c5">m_yMin</a>; y &lt; <a class="code" href="class_render_task.html#a7752df8e1b26574c8b0abc67127496be">m_yMax</a>; y++)</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    {</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;      <span class="comment">//generating aa samples for the pixel</span></div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;      std::vector&lt;ngl::Vec2&gt; samples;</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="class_render_task.html#ace4666e24d370ed1d217334763c64a13">m_settings</a>-&gt;m_aaAmount &gt; 1)</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;      {</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;        <a class="code" href="class_render_task.html#a27953405bdd04505a05b15432c3efb86">generateAASamples</a>(x, y, &amp;samples);</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;      }</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;      {</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;        samples.push_back(ngl::Vec2(x, y));</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;      }</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;      <span class="comment">//rendering the pixel, with the given samples</span></div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;      <a class="code" href="class_render_task.html#a5916c24b5acc4f4a23a76e372f1d0f07">m_film</a>-&gt;<a class="code" href="class_film.html#a3843f0ab3f82ea8652a12f77f292b052">setPixel</a>(x, y, <a class="code" href="class_render_task.html#ac39ef94a96778d36e5f4dea4521906de">renderPixel</a>(samples));</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    }</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;  }</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;}</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;</div>
<div class="line"><a name="l00061"></a><span class="lineno"><a class="line" href="class_render_task.html#ad116ad3ec617574bb9f32f968a98f4a3">   61</a></span>&#160;ngl::Colour <a class="code" href="class_render_task.html#ad116ad3ec617574bb9f32f968a98f4a3">RenderTask::blinnPixel</a>(<a class="code" href="struct_isect_data.html">IsectData</a> *_intersection)</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;{</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;  ngl::Colour outColour(0, 0, 0, 1);</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;  ngl::Colour matColour = _intersection-&gt;<a class="code" href="struct_isect_data.html#a19c0cc7bf05a984d73b9a31dbe38ab95">m_material</a>-&gt;getDiffuseColour(_intersection-&gt;<a class="code" href="struct_isect_data.html#a568d4b9275e5a92beecbd92ab3cdbf65">m_uv</a>[0],</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;                                                                      _intersection-&gt;<a class="code" href="struct_isect_data.html#a568d4b9275e5a92beecbd92ab3cdbf65">m_uv</a>[1]);</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;  <span class="comment">//ambient lighting</span></div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;  outColour += <a class="code" href="class_render_task.html#ace4666e24d370ed1d217334763c64a13">m_settings</a>-&gt;m_ambientCol * matColour;</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;  <span class="comment">//after ambien colour, each lights contribution to the specular and diffuse terms are calulated</span></div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="struct_light.html">Light</a> &amp;l: *<a class="code" href="class_render_task.html#abf43356e83e0a3be5880dc84101803e8">m_scene</a>-&gt;getLights())</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;  {</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    <span class="comment">// if the light is visible, its contribution to the point is calculated</span></div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="class_render_task.html#a5a8b04f2e09fef3771c631a32f1010a9">isVisible</a>(_intersection-&gt;<a class="code" href="struct_isect_data.html#a1a058d9ac166deeddd6e128e8c8cbabc">m_pos</a>, l.m_pos))</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    {</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;      <span class="comment">// setting up lighting variables</span></div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;      ngl::Vec3 normal(_intersection-&gt;<a class="code" href="struct_isect_data.html#ab6e0bbb7bb7c12194a2267bc65d3c266">m_n</a>);</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;      ngl::Vec3 lightDir(l.m_pos - _intersection-&gt;<a class="code" href="struct_isect_data.html#a1a058d9ac166deeddd6e128e8c8cbabc">m_pos</a>);</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;      <span class="keywordtype">double</span> lightDist = lightDir.length();</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;      <span class="keywordtype">double</span> attenuation = 1.0 / (1.0 + 0.1 * lightDist + 0.01 * lightDist * lightDist);</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;      ngl::Vec3 eyeDir(_intersection-&gt;<a class="code" href="struct_isect_data.html#ab41ccb8c1fd6a8a1347a405e8e48e90c">m_eyeDir</a>);</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;      ngl::Vec3 reflectDir(normal * 2 * (normal.dot(eyeDir)) - eyeDir);</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;      ngl::Vec3 halfVec(lightDir + eyeDir);</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;      lightDir.normalize();</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;      eyeDir.normalize();</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;      reflectDir.normalize();</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;      halfVec.normalize();</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;      <span class="keywordtype">double</span> NdotH = std::max(0.0, (<span class="keywordtype">double</span>)normal.dot(halfVec));</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;      <span class="keywordtype">double</span> NdotL = std::max(0.0, (<span class="keywordtype">double</span>)normal.dot(lightDir));</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;      <span class="comment">// specular lighting</span></div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;      outColour += (l.m_colour * std::pow(NdotH, _intersection-&gt;<a class="code" href="struct_isect_data.html#a19c0cc7bf05a984d73b9a31dbe38ab95">m_material</a>-&gt;m_smoothness) * attenuation * l.m_intensity);</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;      <span class="comment">// diffuse lighting</span></div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;      outColour += l.m_colour * NdotL * matColour * attenuation * l.m_intensity;</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    }</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;  }</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;  <span class="comment">// clamping the colour that goes to the display</span></div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;  outColour.clamp(0, 1);</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;  <span class="keywordflow">return</span> outColour;</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;}</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;</div>
<div class="line"><a name="l00105"></a><span class="lineno"><a class="line" href="class_render_task.html#a5a8b04f2e09fef3771c631a32f1010a9">  105</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="class_render_task.html#a5a8b04f2e09fef3771c631a32f1010a9">RenderTask::isVisible</a>(ngl::Vec3 _point, ngl::Vec3 _lightPos)</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;{</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;  <span class="comment">// direction from intersection to light</span></div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;  ngl::Vec3 direction(_lightPos - _point);</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;  <span class="comment">// offset the position so that there are no intersections with the surface it is bouncing off</span></div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;  _point += direction*0.001;</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;  <a class="code" href="class_ray.html">Ray</a> shadowRay(_point, direction);</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;  <span class="comment">// because i dont normalise the vector betwen the light and the point, at t = 1 is when it has reached the light</span></div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;  shadowRay.<a class="code" href="class_ray.html#a8c00458c667d39081ba9340475d30f51">m_maxT</a> = 1;</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="class_render_task.html#abf43356e83e0a3be5880dc84101803e8">m_scene</a>-&gt;sIntersect(shadowRay))</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;  {</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;  }</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;}</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;</div>
<div class="line"><a name="l00121"></a><span class="lineno"><a class="line" href="class_render_task.html#ac39ef94a96778d36e5f4dea4521906de">  121</a></span>&#160;ngl::Colour <a class="code" href="class_render_task.html#ac39ef94a96778d36e5f4dea4521906de">RenderTask::renderPixel</a>(std::vector&lt;ngl::Vec2&gt; _pixelSample)</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;{</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;  <span class="comment">// renders each of the samples and averages the results</span></div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;  ngl::Colour outCol;</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> p: _pixelSample)</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;  {</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    <span class="comment">// generate and trace a ray for each sampls</span></div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    <a class="code" href="class_ray.html">Ray</a> newRay;</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    <a class="code" href="class_render_task.html#a952039fa657660a2b69c96919b53da0a">m_cam</a>-&gt;<a class="code" href="class_camera.html#acbdb7ed64b9b49af38c685c745c319fe">generateRay</a>(p[0], p[1], &amp;newRay);</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    outCol = outCol + <a class="code" href="class_render_task.html#afbd291bef79f1ab0ed146849b4ada898">traceRay</a>(newRay);</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;  }</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;  <span class="comment">// averaging the output colour</span></div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;  outCol *= (1.0/_pixelSample.size());</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;  <span class="keywordflow">return</span> outCol;</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;}</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;</div>
<div class="line"><a name="l00137"></a><span class="lineno"><a class="line" href="class_render_task.html#afbd291bef79f1ab0ed146849b4ada898">  137</a></span>&#160;ngl::Colour <a class="code" href="class_render_task.html#afbd291bef79f1ab0ed146849b4ada898">RenderTask::traceRay</a>(<span class="keyword">const</span> <a class="code" href="class_ray.html">Ray</a> &amp;_ray)</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;{</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;  <span class="comment">// setting the colour to the background colour, in case no intersections are found</span></div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;  ngl::Colour outCol(<a class="code" href="class_render_task.html#ace4666e24d370ed1d217334763c64a13">m_settings</a>-&gt;m_bgCol);</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;  <a class="code" href="struct_isect_data.html">IsectData</a> isect;</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;  <span class="comment">// intersect the scene with the ray</span></div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="class_render_task.html#abf43356e83e0a3be5880dc84101803e8">m_scene</a>-&gt;intersect(_ray, &amp;isect))</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;  {</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    <span class="comment">//init reflected and refracted colour</span></div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    ngl::Colour reflectedCol(<a class="code" href="class_render_task.html#ace4666e24d370ed1d217334763c64a13">m_settings</a>-&gt;m_bgCol);</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    ngl::Colour refractedCol(<a class="code" href="class_render_task.html#ace4666e24d370ed1d217334763c64a13">m_settings</a>-&gt;m_bgCol);</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    <span class="comment">// refractive indicies of materials, n1 is current material, n2 is new material</span></div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    <span class="keywordtype">double</span> n1 = 1;</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    <span class="keywordtype">double</span> n2 = 1;</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    <span class="comment">// using the interpolated normal and eye direction to find out what side of the boundary on</span></div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    <span class="comment">// assumes all normals point outwards (which they do for my  procedural meshes and</span></div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    <span class="comment">// it is on the used to ensure their objs are good</span></div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    <span class="comment">// air -&gt; geometry boundary</span></div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    <span class="keywordflow">if</span> (isect.<a class="code" href="struct_isect_data.html#ab41ccb8c1fd6a8a1347a405e8e48e90c">m_eyeDir</a>.dot(isect.<a class="code" href="struct_isect_data.html#ab6e0bbb7bb7c12194a2267bc65d3c266">m_n</a>) &lt; 0)</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    {</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;      n2 = isect.<a class="code" href="struct_isect_data.html#a19c0cc7bf05a984d73b9a31dbe38ab95">m_material</a>-&gt;m_ior;</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    }</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    <span class="comment">// geometry -&gt; air boundary</span></div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    {</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;      <span class="comment">// reverse the normal if the ray is coming out</span></div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;      n1 = isect.<a class="code" href="struct_isect_data.html#a19c0cc7bf05a984d73b9a31dbe38ab95">m_material</a>-&gt;m_ior;</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;      isect.<a class="code" href="struct_isect_data.html#ab6e0bbb7bb7c12194a2267bc65d3c266">m_n</a> = -isect.<a class="code" href="struct_isect_data.html#ab6e0bbb7bb7c12194a2267bc65d3c266">m_n</a>;</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    }</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    <span class="comment">// using the shlick approximation to find out how much light is reflected (the rest is refracted)</span></div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    <span class="keywordtype">double</span> reflectedAmount = <a class="code" href="class_render_task.html#ae74772203fe5c85fe44918e51b84e489">rShclick</a>(isect.<a class="code" href="struct_isect_data.html#ab6e0bbb7bb7c12194a2267bc65d3c266">m_n</a>, isect.<a class="code" href="struct_isect_data.html#ab41ccb8c1fd6a8a1347a405e8e48e90c">m_eyeDir</a>, n1, n2);</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    <span class="keywordflow">if</span> (_ray.<a class="code" href="class_ray.html#a03a8666bba98c8fd8de5d0158a95ae61">m_depth</a> &lt; <a class="code" href="class_render_task.html#ace4666e24d370ed1d217334763c64a13">m_settings</a>-&gt;m_maxRayBounces)</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    {</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;      <span class="keywordflow">if</span> (isect.<a class="code" href="struct_isect_data.html#a19c0cc7bf05a984d73b9a31dbe38ab95">m_material</a>-&gt;m_isReflective)</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;      {</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;        ngl::Vec3 reflectedDir(<a class="code" href="class_render_task.html#a42ba8c1f423ea1e7d938cea0ba35d027">reflect</a>(isect.<a class="code" href="struct_isect_data.html#ab6e0bbb7bb7c12194a2267bc65d3c266">m_n</a>, isect.<a class="code" href="struct_isect_data.html#ab41ccb8c1fd6a8a1347a405e8e48e90c">m_eyeDir</a>));</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;        <a class="code" href="class_ray.html">Ray</a> reflectedRay(isect.<a class="code" href="struct_isect_data.html#a1a058d9ac166deeddd6e128e8c8cbabc">m_pos</a> + 0.0001 * reflectedDir, reflectedDir, _ray.<a class="code" href="class_ray.html#a03a8666bba98c8fd8de5d0158a95ae61">m_depth</a> + 1);</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;        reflectedCol = <a class="code" href="class_render_task.html#afbd291bef79f1ab0ed146849b4ada898">traceRay</a>(reflectedRay);</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;      }</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;      <span class="keywordflow">else</span> reflectedAmount = 0;</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;      <span class="comment">//std::cout &lt;&lt; reflectedCol.m_r &lt;&lt; std::endl;</span></div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;      <span class="keywordflow">if</span> (isect.<a class="code" href="struct_isect_data.html#a19c0cc7bf05a984d73b9a31dbe38ab95">m_material</a>-&gt;m_isTransparent)</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;      {</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;        ngl::Vec3 refractedDir(<a class="code" href="class_render_task.html#a3b9a7f7a4f653559cff36d5e7f54f0b4">refract</a>(isect.<a class="code" href="struct_isect_data.html#ab6e0bbb7bb7c12194a2267bc65d3c266">m_n</a>, isect.<a class="code" href="struct_isect_data.html#ab41ccb8c1fd6a8a1347a405e8e48e90c">m_eyeDir</a>, n1, n2));</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;        <span class="comment">//check for tir</span></div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;        <span class="keywordflow">if</span> (refractedDir != ngl::Vec3(0, 0, 0))</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;        {</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;          <a class="code" href="class_ray.html">Ray</a> refractedRay(isect.<a class="code" href="struct_isect_data.html#a1a058d9ac166deeddd6e128e8c8cbabc">m_pos</a> + 0.0001 * refractedDir, refractedDir, _ray.<a class="code" href="class_ray.html#a03a8666bba98c8fd8de5d0158a95ae61">m_depth</a> + 1);</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;          refractedCol = <a class="code" href="class_render_task.html#afbd291bef79f1ab0ed146849b4ada898">traceRay</a>(refractedRay);</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;        }</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;      }</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;      <span class="comment">// default refracted amout to blinn shading if material is not transparent</span></div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;      {</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;        refractedCol = <a class="code" href="class_render_task.html#ad116ad3ec617574bb9f32f968a98f4a3">blinnPixel</a>(&amp;isect);</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;      }</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    }</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;    <span class="comment">// default to blinn shading if max ray bounces have been reached</span></div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    {</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;      refractedCol = <a class="code" href="class_render_task.html#ad116ad3ec617574bb9f32f968a98f4a3">blinnPixel</a>(&amp;isect);</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;      reflectedAmount = 0;</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    }</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    <span class="comment">//refractive calculations</span></div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    outCol = refractedCol * (1 - reflectedAmount) + reflectedCol * reflectedAmount;</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;  }</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;  <span class="keywordflow">return</span> outCol;</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;}</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;</div>
<div class="line"><a name="l00212"></a><span class="lineno"><a class="line" href="class_render_task.html#a42ba8c1f423ea1e7d938cea0ba35d027">  212</a></span>&#160;ngl::Vec3 <a class="code" href="class_render_task.html#a42ba8c1f423ea1e7d938cea0ba35d027">RenderTask::reflect</a>(<span class="keyword">const</span> ngl::Vec3 _normal, <span class="keyword">const</span> ngl::Vec3 _incident)</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;{</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;  <span class="comment">/* calulating the reflected direction of a ray using examples from:</span></div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;<span class="comment">   * http://graphics.stanford.edu/courses/cs148-10-summer/docs/2006--degreve--reflection_refraction.pdf</span></div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;<span class="comment">   */</span></div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;  <span class="comment">// angle between incident and normal</span></div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;  <span class="comment">// negative because the incident vector is coming towards the point and needs to be reversed</span></div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;  <span class="keywordtype">double</span> cosI = _normal.dot(-_incident);</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;  <span class="keywordflow">return</span> _incident + _normal * 2 * cosI;</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;}</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;</div>
<div class="line"><a name="l00223"></a><span class="lineno"><a class="line" href="class_render_task.html#a3b9a7f7a4f653559cff36d5e7f54f0b4">  223</a></span>&#160;ngl::Vec3 <a class="code" href="class_render_task.html#a3b9a7f7a4f653559cff36d5e7f54f0b4">RenderTask::refract</a>(<span class="keyword">const</span> ngl::Vec3 _normal, <span class="keyword">const</span> ngl::Vec3 _incident, <span class="keywordtype">double</span> _n1, <span class="keywordtype">double</span> _n2)</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;{</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;  <span class="comment">/* calulating the reflected direction of a ray using examples from:</span></div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;<span class="comment">   * http://graphics.stanford.edu/courses/cs148-10-summer/docs/2006--degreve--reflection_refraction.pdf</span></div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;<span class="comment">   */</span></div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;  <span class="keywordtype">double</span> n = _n1/_n2;</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;  <span class="keywordtype">double</span> cosI = -_normal.dot(_incident);</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;  <span class="keywordtype">double</span> sinT2 = n * n * (1.0 - cosI * cosI);</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;  <span class="keywordflow">if</span> (sinT2 &gt; 1.0)</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;  {</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;    <span class="keywordflow">return</span> ngl::Vec3(0, 0, 0); <span class="comment">// total internal reflection</span></div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;  }</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;  <span class="keywordtype">double</span> cosT = sqrt(1.0 - sinT2);</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;  <span class="keywordflow">return</span> n * _incident + (n * cosI - cosT) * _normal;</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;}</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;</div>
<div class="line"><a name="l00240"></a><span class="lineno"><a class="line" href="class_render_task.html#ae74772203fe5c85fe44918e51b84e489">  240</a></span>&#160;<span class="keywordtype">double</span> <a class="code" href="class_render_task.html#ae74772203fe5c85fe44918e51b84e489">RenderTask::rShclick</a>(<span class="keyword">const</span> ngl::Vec3 _normal, <span class="keyword">const</span> ngl::Vec3 _incident, <span class="keywordtype">double</span> _n1, <span class="keywordtype">double</span> _n2)</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;{</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;  <span class="comment">/* calculating the fresnel factor using schlicks approximation, code and explnation can be found at:</span></div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;<span class="comment">   * http://graphics.stanford.edu/courses/cs148-10-summer/docs/2006--degreve--reflection_refraction.pdf</span></div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;<span class="comment">   */</span></div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;  <span class="keywordtype">double</span> r0 = (_n1 - _n2) / (_n1 + _n2);</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;  r0 *= r0;</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;  <span class="keywordtype">double</span> cosI = _normal.dot(-_incident);</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;  <span class="keywordflow">if</span> (_n1 &gt; _n2)</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;  {</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    <span class="keywordtype">double</span> n = _n1 / _n2;</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;    <span class="keywordtype">double</span> sinT2 = n * n * (1.0 - cosI * cosI);</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;    <span class="keywordflow">if</span> (sinT2 &gt; 1.0)</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    {</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;      <span class="comment">// total internal reflection</span></div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;      <span class="keywordflow">return</span> 1.0;</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    }</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    cosI = sqrt(1.0 - sinT2);</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;  }</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;  <span class="keywordtype">double</span> x = 1.0 - cosI;</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;  <span class="keywordtype">double</span> schlick =  r0 + (1.0 - r0) * x * x * x * x * x;</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;  <span class="comment">// &quot;fixing&quot; an odd rounding error</span></div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;  <span class="keywordflow">if</span> (schlick &gt; .999) <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;  <span class="keywordflow">return</span> schlick;</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;}</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;</div>
<div class="line"><a name="l00266"></a><span class="lineno"><a class="line" href="class_render_task.html#a27953405bdd04505a05b15432c3efb86">  266</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_render_task.html#a27953405bdd04505a05b15432c3efb86">RenderTask::generateAASamples</a>(<span class="keyword">const</span> <span class="keywordtype">int</span> _x, <span class="keyword">const</span> <span class="keywordtype">int</span> _y, std::vector&lt;ngl::Vec2&gt; *_samples)</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;{</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;  <span class="comment">// random number generator to generate random samples</span></div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="class_render_task.html#ace4666e24d370ed1d217334763c64a13">m_settings</a>-&gt;m_aaAmount; i++)</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;  {</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;    <span class="keywordtype">double</span> x = <a class="code" href="class_render_task.html#a2ec2ffc7d648a128606d10c171f313b8">m_distribution</a>(<a class="code" href="class_render_task.html#a29fb8fe5f3a20d5c2ed8bcaadb2f8962">m_generator</a>) + (double)_x;</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;    <span class="keywordtype">double</span> y = <a class="code" href="class_render_task.html#a2ec2ffc7d648a128606d10c171f313b8">m_distribution</a>(<a class="code" href="class_render_task.html#a29fb8fe5f3a20d5c2ed8bcaadb2f8962">m_generator</a>) + (double)_y;</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;    _samples-&gt;push_back(ngl::Vec2(x, y));</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;  }</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;}</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;</div>
<div class="ttc" id="struct_isect_data_html_ab41ccb8c1fd6a8a1347a405e8e48e90c"><div class="ttname"><a href="struct_isect_data.html#ab41ccb8c1fd6a8a1347a405e8e48e90c">IsectData::m_eyeDir</a></div><div class="ttdeci">ngl::Vec3 m_eyeDir</div><div class="ttdoc">m_eyeDir is a vector from the intersection to the rays origin </div><div class="ttdef"><b>Definition:</b> <a href="_isect_data_8hpp_source.html#l00036">IsectData.hpp:36</a></div></div>
<div class="ttc" id="class_render_task_html_a27953405bdd04505a05b15432c3efb86"><div class="ttname"><a href="class_render_task.html#a27953405bdd04505a05b15432c3efb86">RenderTask::generateAASamples</a></div><div class="ttdeci">void generateAASamples(const int _x, const int _y, std::vector&lt; ngl::Vec2 &gt; *_samples)</div><div class="ttdoc">fills the given vector with randomly generated smaples to be passed to the renderer ...</div><div class="ttdef"><b>Definition:</b> <a href="_render_task_8cpp_source.html#l00266">RenderTask.cpp:266</a></div></div>
<div class="ttc" id="class_render_task_html_ac39ef94a96778d36e5f4dea4521906de"><div class="ttname"><a href="class_render_task.html#ac39ef94a96778d36e5f4dea4521906de">RenderTask::renderPixel</a></div><div class="ttdeci">ngl::Colour renderPixel(std::vector&lt; ngl::Vec2 &gt; pixelSample)</div><div class="ttdoc">renders a single pixel in the final image </div><div class="ttdef"><b>Definition:</b> <a href="_render_task_8cpp_source.html#l00121">RenderTask.cpp:121</a></div></div>
<div class="ttc" id="class_render_task_html_ae4327b10c3c1d16325c0b9d2e124e1c5"><div class="ttname"><a href="class_render_task.html#ae4327b10c3c1d16325c0b9d2e124e1c5">RenderTask::m_yMin</a></div><div class="ttdeci">int m_yMin</div><div class="ttdoc">smallest y coordinate of a pixel in the render task </div><div class="ttdef"><b>Definition:</b> <a href="_render_task_8hpp_source.html#l00116">RenderTask.hpp:116</a></div></div>
<div class="ttc" id="class_render_task_html_a42ba8c1f423ea1e7d938cea0ba35d027"><div class="ttname"><a href="class_render_task.html#a42ba8c1f423ea1e7d938cea0ba35d027">RenderTask::reflect</a></div><div class="ttdeci">ngl::Vec3 reflect(const ngl::Vec3 _normal, const ngl::Vec3 _incident)</div><div class="ttdoc">calulates a direction vector for a reflected ray with given incident normal and incoming direction ...</div><div class="ttdef"><b>Definition:</b> <a href="_render_task_8cpp_source.html#l00212">RenderTask.cpp:212</a></div></div>
<div class="ttc" id="_film_8hpp_html"><div class="ttname"><a href="_film_8hpp.html">Film.hpp</a></div><div class="ttdoc">File contaiing the Film class. </div></div>
<div class="ttc" id="struct_isect_data_html_a19c0cc7bf05a984d73b9a31dbe38ab95"><div class="ttname"><a href="struct_isect_data.html#a19c0cc7bf05a984d73b9a31dbe38ab95">IsectData::m_material</a></div><div class="ttdeci">std::shared_ptr&lt; Material &gt; m_material</div><div class="ttdoc">m_material is a pointer to the material of the intersected geometry </div><div class="ttdef"><b>Definition:</b> <a href="_isect_data_8hpp_source.html#l00039">IsectData.hpp:39</a></div></div>
<div class="ttc" id="class_camera_html"><div class="ttname"><a href="class_camera.html">Camera</a></div><div class="ttdoc">The Camera class is used to generate rays when passed the coordinate of a point in the output image...</div><div class="ttdef"><b>Definition:</b> <a href="_camera_8hpp_source.html#l00022">Camera.hpp:22</a></div></div>
<div class="ttc" id="class_render_task_html_ad116ad3ec617574bb9f32f968a98f4a3"><div class="ttname"><a href="class_render_task.html#ad116ad3ec617574bb9f32f968a98f4a3">RenderTask::blinnPixel</a></div><div class="ttdeci">ngl::Colour blinnPixel(IsectData *_intersection)</div><div class="ttdoc">calulates the colour value for blin shading at the point defined in the intersection data ...</div><div class="ttdef"><b>Definition:</b> <a href="_render_task_8cpp_source.html#l00061">RenderTask.cpp:61</a></div></div>
<div class="ttc" id="class_render_task_html_a2ec2ffc7d648a128606d10c171f313b8"><div class="ttname"><a href="class_render_task.html#a2ec2ffc7d648a128606d10c171f313b8">RenderTask::m_distribution</a></div><div class="ttdeci">std::uniform_real_distribution&lt; double &gt; m_distribution</div><div class="ttdoc">the random number generators distribution </div><div class="ttdef"><b>Definition:</b> <a href="_render_task_8hpp_source.html#l00110">RenderTask.hpp:110</a></div></div>
<div class="ttc" id="class_render_task_html_ace4666e24d370ed1d217334763c64a13"><div class="ttname"><a href="class_render_task.html#ace4666e24d370ed1d217334763c64a13">RenderTask::m_settings</a></div><div class="ttdeci">std::shared_ptr&lt; RenderSettings &gt; m_settings</div><div class="ttdoc">shared pointer to the render settings structure </div><div class="ttdef"><b>Definition:</b> <a href="_render_task_8hpp_source.html#l00104">RenderTask.hpp:104</a></div></div>
<div class="ttc" id="class_render_task_html_a5916c24b5acc4f4a23a76e372f1d0f07"><div class="ttname"><a href="class_render_task.html#a5916c24b5acc4f4a23a76e372f1d0f07">RenderTask::m_film</a></div><div class="ttdeci">Film * m_film</div><div class="ttdoc">pointer to the film where the final image will be stored </div><div class="ttdef"><b>Definition:</b> <a href="_render_task_8hpp_source.html#l00098">RenderTask.hpp:98</a></div></div>
<div class="ttc" id="class_film_html_a3843f0ab3f82ea8652a12f77f292b052"><div class="ttname"><a href="class_film.html#a3843f0ab3f82ea8652a12f77f292b052">Film::setPixel</a></div><div class="ttdeci">void setPixel(int _x, int _y, ngl::Colour _c)</div><div class="ttdoc">sets a pixel in the colour vector </div><div class="ttdef"><b>Definition:</b> <a href="_film_8cpp_source.html#l00019">Film.cpp:19</a></div></div>
<div class="ttc" id="struct_isect_data_html"><div class="ttname"><a href="struct_isect_data.html">IsectData</a></div><div class="ttdoc">a structure that holds information about intersection points. </div><div class="ttdef"><b>Definition:</b> <a href="_isect_data_8hpp_source.html#l00018">IsectData.hpp:18</a></div></div>
<div class="ttc" id="struct_isect_data_html_a568d4b9275e5a92beecbd92ab3cdbf65"><div class="ttname"><a href="struct_isect_data.html#a568d4b9275e5a92beecbd92ab3cdbf65">IsectData::m_uv</a></div><div class="ttdeci">ngl::Vec2 m_uv</div><div class="ttdoc">m_uv holds the interpolated texture coordinate of the intersection point </div><div class="ttdef"><b>Definition:</b> <a href="_isect_data_8hpp_source.html#l00033">IsectData.hpp:33</a></div></div>
<div class="ttc" id="_primative_8hpp_html"><div class="ttname"><a href="_primative_8hpp.html">Primative.hpp</a></div><div class="ttdoc">File contaiing the Primative class. </div></div>
<div class="ttc" id="class_render_task_html_ad22541ecdb33be6cb10553fb35006e74"><div class="ttname"><a href="class_render_task.html#ad22541ecdb33be6cb10553fb35006e74">RenderTask::RenderTask</a></div><div class="ttdeci">RenderTask(Camera *_cam, Film *_film, std::shared_ptr&lt; Scene &gt; _scene, int _xMin, int _yMin, int _xMax, int _yMax, std::shared_ptr&lt; RenderSettings &gt; _settings)</div><div class="ttdoc">ctor that takes in everything needed by the rendertask </div><div class="ttdef"><b>Definition:</b> <a href="_render_task_8cpp_source.html#l00018">RenderTask.cpp:18</a></div></div>
<div class="ttc" id="class_render_task_html_abf43356e83e0a3be5880dc84101803e8"><div class="ttname"><a href="class_render_task.html#abf43356e83e0a3be5880dc84101803e8">RenderTask::m_scene</a></div><div class="ttdeci">std::shared_ptr&lt; Scene &gt; m_scene</div><div class="ttdoc">shared pointer to the scene that is to be rendered </div><div class="ttdef"><b>Definition:</b> <a href="_render_task_8hpp_source.html#l00101">RenderTask.hpp:101</a></div></div>
<div class="ttc" id="class_render_task_html_a952039fa657660a2b69c96919b53da0a"><div class="ttname"><a href="class_render_task.html#a952039fa657660a2b69c96919b53da0a">RenderTask::m_cam</a></div><div class="ttdeci">Camera * m_cam</div><div class="ttdoc">pointer to the camera that will generate the initial rays </div><div class="ttdef"><b>Definition:</b> <a href="_render_task_8hpp_source.html#l00095">RenderTask.hpp:95</a></div></div>
<div class="ttc" id="struct_light_html"><div class="ttname"><a href="struct_light.html">Light</a></div><div class="ttdoc">The light class holds data that defines lights in the scene, A light is a combination of a position...</div><div class="ttdef"><b>Definition:</b> <a href="_light_8hpp_source.html#l00016">Light.hpp:16</a></div></div>
<div class="ttc" id="class_ray_html_a8c00458c667d39081ba9340475d30f51"><div class="ttname"><a href="class_ray.html#a8c00458c667d39081ba9340475d30f51">Ray::m_maxT</a></div><div class="ttdeci">float m_maxT</div><div class="ttdoc">maximum paramteric value (t) for the ray </div><div class="ttdef"><b>Definition:</b> <a href="_ray_8hpp_source.html#l00044">Ray.hpp:44</a></div></div>
<div class="ttc" id="class_render_task_html_ae74772203fe5c85fe44918e51b84e489"><div class="ttname"><a href="class_render_task.html#ae74772203fe5c85fe44918e51b84e489">RenderTask::rShclick</a></div><div class="ttdeci">double rShclick(const ngl::Vec3 _normal, const ngl::Vec3 _incident, double _n1, double _n2)</div><div class="ttdoc">calulates an approximation to the fresnel factor using shclicks approximation </div><div class="ttdef"><b>Definition:</b> <a href="_render_task_8cpp_source.html#l00240">RenderTask.cpp:240</a></div></div>
<div class="ttc" id="struct_isect_data_html_a1a058d9ac166deeddd6e128e8c8cbabc"><div class="ttname"><a href="struct_isect_data.html#a1a058d9ac166deeddd6e128e8c8cbabc">IsectData::m_pos</a></div><div class="ttdeci">ngl::Vec3 m_pos</div><div class="ttdoc">m_pos is the position in world space of the intersection </div><div class="ttdef"><b>Definition:</b> <a href="_isect_data_8hpp_source.html#l00027">IsectData.hpp:27</a></div></div>
<div class="ttc" id="_render_task_8hpp_html"><div class="ttname"><a href="_render_task_8hpp.html">RenderTask.hpp</a></div><div class="ttdoc">File contaiing the RenderTask class. </div></div>
<div class="ttc" id="class_render_task_html_a3b9a7f7a4f653559cff36d5e7f54f0b4"><div class="ttname"><a href="class_render_task.html#a3b9a7f7a4f653559cff36d5e7f54f0b4">RenderTask::refract</a></div><div class="ttdeci">ngl::Vec3 refract(const ngl::Vec3 _normal, const ngl::Vec3 _incident, double _n1, double _n2)</div><div class="ttdoc">calulates a direction vector for a refracted ray with given incident normal and incoming direction ...</div><div class="ttdef"><b>Definition:</b> <a href="_render_task_8cpp_source.html#l00223">RenderTask.cpp:223</a></div></div>
<div class="ttc" id="class_render_task_html_a7752df8e1b26574c8b0abc67127496be"><div class="ttname"><a href="class_render_task.html#a7752df8e1b26574c8b0abc67127496be">RenderTask::m_yMax</a></div><div class="ttdeci">int m_yMax</div><div class="ttdoc">largest y coordinate of a pixel in the render task </div><div class="ttdef"><b>Definition:</b> <a href="_render_task_8hpp_source.html#l00122">RenderTask.hpp:122</a></div></div>
<div class="ttc" id="_material_8hpp_html"><div class="ttname"><a href="_material_8hpp.html">Material.hpp</a></div><div class="ttdoc">File contaiing the Material class that holds data to do with materials in the scene. </div></div>
<div class="ttc" id="class_render_task_html_a723a8517f2d24fdab3e40f47f4404e3e"><div class="ttname"><a href="class_render_task.html#a723a8517f2d24fdab3e40f47f4404e3e">RenderTask::render</a></div><div class="ttdeci">void render()</div><div class="ttdoc">main function that is called to render the range of pixels for this render task </div><div class="ttdef"><b>Definition:</b> <a href="_render_task_8cpp_source.html#l00038">RenderTask.cpp:38</a></div></div>
<div class="ttc" id="struct_isect_data_html_ab6e0bbb7bb7c12194a2267bc65d3c266"><div class="ttname"><a href="struct_isect_data.html#ab6e0bbb7bb7c12194a2267bc65d3c266">IsectData::m_n</a></div><div class="ttdeci">ngl::Vec3 m_n</div><div class="ttdoc">m_n holds the interpolated normal of the intersection point </div><div class="ttdef"><b>Definition:</b> <a href="_isect_data_8hpp_source.html#l00030">IsectData.hpp:30</a></div></div>
<div class="ttc" id="class_render_task_html_af908b199e0e2b5137c3b70806ae6f58c"><div class="ttname"><a href="class_render_task.html#af908b199e0e2b5137c3b70806ae6f58c">RenderTask::m_xMax</a></div><div class="ttdeci">int m_xMax</div><div class="ttdoc">largest x coordinate of a pixel in the render task </div><div class="ttdef"><b>Definition:</b> <a href="_render_task_8hpp_source.html#l00119">RenderTask.hpp:119</a></div></div>
<div class="ttc" id="class_ray_html_a03a8666bba98c8fd8de5d0158a95ae61"><div class="ttname"><a href="class_ray.html#a03a8666bba98c8fd8de5d0158a95ae61">Ray::m_depth</a></div><div class="ttdeci">int m_depth</div><div class="ttdoc">recursive depth of the ray </div><div class="ttdef"><b>Definition:</b> <a href="_ray_8hpp_source.html#l00041">Ray.hpp:41</a></div></div>
<div class="ttc" id="class_film_html"><div class="ttname"><a href="class_film.html">Film</a></div><div class="ttdoc">The Film class holds pixel arrayd for the different render layers. </div><div class="ttdef"><b>Definition:</b> <a href="_film_8hpp_source.html#l00018">Film.hpp:18</a></div></div>
<div class="ttc" id="class_ray_html"><div class="ttname"><a href="class_ray.html">Ray</a></div><div class="ttdoc">The Ray class holds an origin and direction that define a ray Intersection routines are left up to to...</div><div class="ttdef"><b>Definition:</b> <a href="_ray_8hpp_source.html#l00017">Ray.hpp:17</a></div></div>
<div class="ttc" id="class_render_task_html_afbd291bef79f1ab0ed146849b4ada898"><div class="ttname"><a href="class_render_task.html#afbd291bef79f1ab0ed146849b4ada898">RenderTask::traceRay</a></div><div class="ttdeci">ngl::Colour traceRay(const Ray &amp;_ray)</div><div class="ttdoc">traces a single ray into the scene and returns the colour value for that ray </div><div class="ttdef"><b>Definition:</b> <a href="_render_task_8cpp_source.html#l00137">RenderTask.cpp:137</a></div></div>
<div class="ttc" id="class_render_task_html_a6ec50c2582398ec0cefac94862ed3a5e"><div class="ttname"><a href="class_render_task.html#a6ec50c2582398ec0cefac94862ed3a5e">RenderTask::m_xMin</a></div><div class="ttdeci">int m_xMin</div><div class="ttdoc">smallest x coordinate of a pixel in the render task </div><div class="ttdef"><b>Definition:</b> <a href="_render_task_8hpp_source.html#l00113">RenderTask.hpp:113</a></div></div>
<div class="ttc" id="class_render_task_html_a29fb8fe5f3a20d5c2ed8bcaadb2f8962"><div class="ttname"><a href="class_render_task.html#a29fb8fe5f3a20d5c2ed8bcaadb2f8962">RenderTask::m_generator</a></div><div class="ttdeci">std::mt19937 m_generator</div><div class="ttdoc">the render taks random number generator for random sampling </div><div class="ttdef"><b>Definition:</b> <a href="_render_task_8hpp_source.html#l00107">RenderTask.hpp:107</a></div></div>
<div class="ttc" id="class_render_task_html_a5a8b04f2e09fef3771c631a32f1010a9"><div class="ttname"><a href="class_render_task.html#a5a8b04f2e09fef3771c631a32f1010a9">RenderTask::isVisible</a></div><div class="ttdeci">bool isVisible(ngl::Vec3 _origin, ngl::Vec3 _lightPos)</div><div class="ttdoc">a function that checks for a direct line of sight between a point and a light, used to calulate shadd...</div><div class="ttdef"><b>Definition:</b> <a href="_render_task_8cpp_source.html#l00105">RenderTask.cpp:105</a></div></div>
<div class="ttc" id="_camera_8hpp_html"><div class="ttname"><a href="_camera_8hpp.html">Camera.hpp</a></div><div class="ttdoc">File contaiing the Camera class. </div></div>
<div class="ttc" id="class_camera_html_acbdb7ed64b9b49af38c685c745c319fe"><div class="ttname"><a href="class_camera.html#acbdb7ed64b9b49af38c685c745c319fe">Camera::generateRay</a></div><div class="ttdeci">void generateRay(double _x, double _y, Ray *_ray)</div><div class="ttdoc">fills the ray with an origin and direction corresponding to the x, y pixel on the final image ...</div><div class="ttdef"><b>Definition:</b> <a href="_camera_8cpp_source.html#l00054">Camera.cpp:54</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu Apr 14 2016 17:26:08 for myRT by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.9.1
</small></address>
</body>
</html>
